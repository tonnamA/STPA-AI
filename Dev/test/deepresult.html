<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="../theme.js"></script>
    <link rel="stylesheet" href="/navbar.css">
</head>

<body>
    <nav>
        <ul>
            <li><a href="#" class="special">STPA-AI</a></li>
            <div class="center">
                <li class="hide"><a href="/setting.html" class="change">ตั้งค่า</a></li>
                <li class="hide"><a href="../content.html" class="change">ฝึกฝน</a></li>
                <li class="hide"><a href="#" class="change">API's</a></li>
            </div>
            <li id="sun"><a href="#" class="hide"><svg xmlns="http://www.w3.org/2000/svg" height="24px"
                        viewBox="0 -960 960 960" width="24px" fill="#1f1f1f">
                        <path
                            d="M480-360q50 0 85-35t35-85q0-50-35-85t-85-35q-50 0-85 35t-35 85q0 50 35 85t85 35Zm0 80q-83 0-141.5-58.5T280-480q0-83 58.5-141.5T480-680q83 0 141.5 58.5T680-480q0 83-58.5 141.5T480-280ZM200-440H40v-80h160v80Zm720 0H760v-80h160v80ZM440-760v-160h80v160h-80Zm0 720v-160h80v160h-80ZM256-650l-101-97 57-59 96 100-52 56Zm492 496-97-101 53-55 101 97-57 59Zm-98-550 97-101 59 57-100 96-56-52ZM154-212l101-97 55 53-97 101-59-57Zm326-268Z" />
                    </svg></a></li>
            <li class="menubtn"><a href="#" onclick="showsidebar()"><svg xmlns="http://www.w3.org/2000/svg"
                        height="26px" viewBox="0 -960 960 960" width="26px" fill="#1f1f1f">
                        <path d="M120-240v-80h720v80H120Zm0-200v-80h720v80H120Zm0-200v-80h720v80H120Z" /></svg></a></li>
        </ul>
    </nav>


    <div class="undernav">
        <div class="icon" onclick="history.back()">
            <a href="#"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path id="Vector"
                        d="M15 6L9.7071 11.2929C9.3738 11.6262 9.2071 11.7929 9.2071 12C9.2071 12.2071 9.3738 12.3738 9.7071 12.7071L15 18"
                        stroke="#2A353D" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </a>
            <a href="#" class="back">ย้อนกลับ</a>
        </div>


        <div class="pack">
            <a href="../content.html" id="nav-test">บทช่วยสอน</a>
            <a href="page.html" id="nav-page">ฝึกฝน</a>
            <a href="#" id="result-page">ดูผลลัพธ์</a>
        </div>
    </div>

    <main>
        <h1>ข้อมูลเชิงลึก</h1>
        <div class="container">
            <div class="text text1">
                <div class="text-wrapper" style="display: flex; gap: 20px; padding: 10px; display: flex; align-items: center; justify-content: center;">
                    <h1>จำนวนคำที่ออกเสียงถูกต้อง</h1>
                    <button onclick="showtext()"">show</button>
                </div>
                    <div class="text2" style="display: none; gap: 20px;">
                        <div class="left">
                            <p>๏ บัดเดี๋ยวดังหงั่งเหง่งวังเวงแว่ว
                                <br>
                                เห็นโยคีขี่รุ้งพุ่งออกมา
                                <br>
                                แล้วสอนว่าอย่าไว้ใจมนุษย์
                                <br>
                                ถึงเถาวัลย์พันเกี่ยวที่เลี้ยวลด
                                <br>
                                มนุษย์นี้ที่รักอยู่สองสถาน
                                <br>
                                ที่พึ่งหนึ่งพึ่งได้แต่กายตน
                                <br>
                                แม้นใครรักรักมั่งชังชังตอบ
                                <br>
                                รู้สิ่งไรไม่สู้รู้วิชา
                                <br>
                                จงคิดตามไปเอาไม้เท้าเถิด
                                <br>
                                พอเสร็จคำสำแดงแจ้งคดี</p>
                        </div>
                        <div class="right">
                            <p>สะดุ้งแล้วเหลียวแลชะแง้หา
                                <br>
                                ประคองพาขึ้นไปจนบนบรรพต
                
                                <br>
                                มันแสนสุดลึกล้ำเหลือกำหนด
                
                                <br>
                                ก็ไม่คดเหมือนหนึ่งในน้ำใจคน
                
                                <br>
                                บิดามารดารักมักเป็นผล
                
                                <br>
                                เกิดเป็นคนคิดเห็นจึงเจรจา
                
                                <br>
                                ให้รอบคอบคิดอ่านนะหลานหนา
                
                                <br>
                                รู้รักษาตัวรอดเป็นยอดดี
                
                                <br>
                                จะประเสริฐสมรักเป็นศักดิ์ศรี
                
                                <br>
                                รูปโยคีหายวับไปกับตา ฯ</p>
                        </div>
                    </div>
                </div>
            <div class="text">
                <h1>การแบ่งวรรคอ่านถูกต้อง</h1>
                <h2 id="correctSpace"></h2>
            </div>
            <div class="text">
                <h1>การเอื้อนถูกต้อง</h1>
                <h2 id="correctSound"></h2>
            </div>
            <div class="text">
                <h1>ผลลัพธ์โดยรวม</h1>
                <h2 id="overall"></h2>
            </div>

        </div>
    </main>


    <nav>
        <ul class="sidebar">
            <li><a href="#" onclick="hidesidebar()"><svg xmlns="http://www.w3.org/2000/svg" height="24px"
                        viewBox="0 -960 960 960" width="24px" fill="#1f1f1f">
                        <path
                            d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z" />
                    </svg></a></li>
            <div class="center">
                <li><a href="/setting.html" class="change">ตั้งค่า</a></li>
                <li><a href="../content.html" class="change">ฝึกฝน</a></li>
                <li><a href="#" class="change">API's</a></li>
            </div>
            <li id="sun"><a href="#"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960"
                        width="24px" fill="#1f1f1f">
                        <path
                            d="M480-360q50 0 85-35t35-85q0-50-35-85t-85-35q-50 0-85 35t-35 85q0 50 35 85t85 35Zm0 80q-83 0-141.5-58.5T280-480q0-83 58.5-141.5T480-680q83 0 141.5 58.5T680-480q0 83-58.5 141.5T480-280ZM200-440H40v-80h160v80Zm720 0H760v-80h160v80ZM440-760v-160h80v160h-80Zm0 720v-160h80v160h-80ZM256-650l-101-97 57-59 96 100-52 56Zm492 496-97-101 53-55 101 97-57 59Zm-98-550 97-101 59 57-100 96-56-52ZM154-212l101-97 55 53-97 101-59-57Zm326-268Z" />
                    </svg></a></li>
        </ul>
    </nav>


</body>
<style>
    html.dark{
        background-color: black;
    }
    .text1{
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }
    .text2{
        display: flex;
    }
    button{
        background-color: white;
        border-radius: 5px;
        /* height: 20px; */
        cursor: pointer;
        padding: 0.5rem 1rem;
    }
    .dark .pack a{
        color: white;
    }
    .dark main h1{
        color: white;
    }
    .dark .container h2{
        color: white;
    }
    .pack {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 36px;
        margin: auto;
    }

    .undernav {
        display: flex;
        justify-content: space-between;
        align-items: center;
        /* margin: auto; */
    }

    .pack a {
        text-decoration: none;
        color: var(--Color-Palete-black-black-500, #555);
        font-size: calc(14px, 10vw, 32px);
    }

    .icon a {
        color: #000;
        /* TH/body/regular/base */
        font-family: "IBM Plex Sans Thai";
        font-size: 16px;
        font-style: normal;
        font-weight: 400;
        line-height: 144%;
        /* 23.04px */
        letter-spacing: 1px;
        text-decoration: none;
    }

    .icon {
        display: flex; 
        align-items: center;
        margin-left: 15px;
    }
    main{
        padding: 0 1rem;
    }
    main h1{
        color: var(--Color-Palete-General-Purpose-black, #000);

        /* TH/display/semibold/base */
        font-family: "IBM Plex Sans Thai";
        font-size: calc(16px,10vw,48px);
        font-style: normal;
        font-weight: 600;
        line-height: 120%; /* 50.4px */
        letter-spacing: -0.525px;
        text-align: center;
       padding: 2rem 0;
    }
    .container h2{
        color:#555;

        /* EN/heading/regular/m */
        font-family: "IBM Plex Sans Thai";
       font-size: calc(12px,10vw,24px);
        font-style: normal;
        font-weight: 400;
        line-height: 130%; /* 31.2px */
        letter-spacing: -0.12px;
    }
    .text{
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 20px;
    }
    .text h1,h2{
       font-size: 1.5rem;
    }
    .container{
        display: flex;
        align-items: center;
        justify-self: center;
        justify-content: center;
        max-width: 900px;
        height: auto;
        width: 100%;
        padding:1rem;
        border: 1px solid #555;
        border-radius: 10px;
        flex-direction: column;
    }
    .highlight {
    color: red;
    font-weight: bold;
  }

    @media (min-width:1450px){
        .undernav{
            height: 50px;
        }
        .undernav a{
            font-size: 1.5rem;
        }
    }
    @media (max-width:800px){
        .text{
            display: block;
        }
        .text2{
            display: block;
        }
    }
</style>
<script>
    if (location.pathname.includes("deepresult.html")) {
            document.getElementById("result-page")?.classList.add("active-link");
     }
     function showsidebar() {
    const sidebar = document.querySelector(".sidebar");
    sidebar.classList.add("active");
}

function showtext(){
    const textDiv = document.querySelector('.text2');
    const button = document.querySelector('button');

    if (textDiv.style.display === 'none' || textDiv.style.display === '') {
        textDiv.style.display = 'flex';
        button.innerText = 'hide';
    } else {
        textDiv.style.display = 'none';
        button.innerText = 'show';
    }
  

}
function hidesidebar() {
    const sidebar = document.querySelector(".sidebar");
    sidebar.classList.remove("active");
}


// localStorage.setItem("username","demo") 
// const username = localStorage.getItem("username"); 
//     fetch("http://127.0.0.1:8000/deepresult", {
//       method: "POST",
//       headers: {
//           "Content-Type": "application/json"
//       },
//       body: JSON.stringify({ username: username })
//   })
//   .then(res => res.json())
//   .then(data => {
//     const result = data.result[0];
//     document.getElementById("correctSpace").innerText = result.correctspace; //แบ่งวรรค
//     document.getElementById("correctSound").innerText = result.correctsound;
//     document.getElementById("overall").innerText = result.overall;
    
//   })
//   .catch(err => {
//       console.error(err);
//   });



  





    





    localStorage.setItem("username","demo")
    const username = localStorage.getItem("username")
  const thaiChars = [
      'ก', 'ข', 'ฃ', 'ค', 'ฅ', 'ฆ', 'ง', 'จ', 'ฉ', 'ช',
      'ซ', 'ฌ', 'ญ', 'ฎ', 'ฏ', 'ฐ', 'ฑ', 'ฒ', 'ณ', 'ด',
      'ต', 'ถ', 'ท', 'ธ', 'น', 'บ', 'ป', 'ผ', 'ฝ', 'พ',
      'ฟ', 'ภ', 'ม', 'ย', 'ร', 'ล', 'ว', 'ศ', 'ษ', 'ส',
      'ห', 'ฬ', 'อ', 'ฮ',
      'ะ', 'ั', 'า', 'ิ', 'ี', 'ึ', 'ื', 'ุ', 'ู',
      'เ', 'แ', 'โ', 'ใ', 'ไ', 'ฤ', 'ฦ', 'ำ',
      '่', '้', '๊', '๋', '์',
      ' '
    ];
  
    async function fetchAndHighlight() {
      try {
        const res = await  fetch("http://127.0.0.1:8000/highlight", {
      method: "POST",
      headers: {
          "Content-Type": "application/json"
      },
      body: JSON.stringify({ username: username })
  }); // เรียก backend
        const data = await res.json();
        const arr = data.arr;
  
        // แปลง arr เป็นข้อความสำหรับ highlight
        const searchText = arr.map(i => thaiChars[i] || '').join('');
        console.log('searchText:', searchText);
  
        const container = document.querySelector('.text2');
  
        // ฟังก์ชันไฮไลท์ข้อความใน container
        function highlightTextInElement(container, textToFind) {
          if (!textToFind) return;
  
          const escapeRegExp = s => s.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');
          const regex = new RegExp(escapeRegExp(textToFind), 'g');
  
          const walker = document.createTreeWalker(container, NodeFilter.SHOW_TEXT, null, false);
  
          let node;
          const nodesToReplace = [];
  
          while(node = walker.nextNode()) {
            if(node.nodeValue.includes(textToFind)) {
              nodesToReplace.push(node);
            }
          }
  
          nodesToReplace.forEach(textNode => {
            const parent = textNode.parentNode;
            const frag = document.createDocumentFragment();
            const text = textNode.nodeValue;
            let lastIndex = 0;
            let match;
  
            while ((match = regex.exec(text)) !== null) {
              const before = text.slice(lastIndex, match.index);
              if(before.length > 0) {
                frag.appendChild(document.createTextNode(before));
              }
              const highlightSpan = document.createElement('span');
              highlightSpan.className = 'highlight';
              highlightSpan.textContent = match[0];
              frag.appendChild(highlightSpan);
              lastIndex = regex.lastIndex;
            }
            const after = text.slice(lastIndex);
            if(after.length > 0) {
              frag.appendChild(document.createTextNode(after));
            }
  
            parent.replaceChild(frag, textNode);
          });
        }
  
        highlightTextInElement(container, searchText);
  
      } catch(err) {
        console.error('Error fetching or highlighting:', err);
      }
    }
  
    fetchAndHighlight();
</script>
</html>